
<!DOCTYPE html>
<html>
<head>
  <title>Online Store</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
<section class="container-fluid text-center">
<h1>My Tool Store</h1>
</section>
<br>
<section class="container border shadow">
<table id="products" class="table border mt-3">
  <thead>
  <tr>
    <th scope="col">Title</th>
    <th scope="col">Quantity</th>
    <th scope="col">Price</th>
    <th scope="col">Categories</th>
  </tr>
  </thead>
  <tbody id="insertProducts"></tbody>
</table>
  <button class="btn btn-secondary ml-0 mb-3" id="refresh-btn">Refresh</button>
</section>
<section class="container">

</section>

<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
<script>
  (function() {
    "use strict";

    function Listing (item) {
      this.title = item.title;
      this.quantity = item.quantity;
      this.categories = [...item.categories];
      this.price = item.price;
    }

    Listing.prototype.buildTableRow = function () {
      const $title = $(document.createElement('th'))
              .attr('scope', 'row')
              .text(this.title);
      const $quantity = $(document.createElement('td'))
              .text(this.quantity);
      const $price = $(document.createElement('td'))
              .text(this.price);
      const $categories = $(document.createElement('td'))
              .text(this.categories.join(', '));
      return $(document.createElement('tr'))
              .append($title)
              .append($quantity)
              .append($price)
              .append($categories)
    }

    // TODO: Create an AJAX GET request for the file under data/inventory.json
    function inventoryRequest() {
      $.get("/data/inventory.json").done(function (data) {
        // let freshInv = '<tbody id="insertProducts">'
        let $freshInventory = $(document.createElement('tbody'))
                .attr('id', 'insertProducts');
        // go through all items listed in inventory
        data.forEach(function (item) {
          let itemRow = new Listing(item);
          $freshInventory.append(itemRow.buildTableRow());
          // prepare the table data
          // let title = '<th scope="row">' + item.title + '</th>';
          // let quantity = '<td>' + item.quantity + '</td>';
          // let price = '<td>' + `$${parseFloat(item.price).toFixed(2)}` + '</td>';
          // special case for category as it can be an array of values
          // let category = "<td>";
          // for (let cat of item.categories) {
          //   category += cat + ' ';
          // }
          // category += "</td>"
          // put all together into a complete row for this item
          // let freshRow = '<tr>' + title + quantity + price + category + '</tr>';
          // append the contents of the current item as a row to the existing table body being built up
          // freshInv += freshRow;
        });
        // freshInv += '</tbody>';
        $('#insertProducts').replaceWith($freshInventory);
      });
    }

    // build page contents on document ready
    // commented out to allow refresh button demo!
    // inventoryRequest();

    // TODO: Take the data from inventory.json and append it to the products table
    //       HINT: Your data should come back as a JSON object; use console.log() to inspect
    //             its contents and fields
    //       HINT: You will want to target #insertProducts for your new HTML elements
    $('#refresh-btn').on('click', function (e) {
      e.preventDefault();
      inventoryRequest();
    })
  })();
</script>

</body>
</html>